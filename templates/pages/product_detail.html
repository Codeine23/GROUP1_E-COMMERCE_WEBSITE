{% extends "layouts/base.html" %}
{% block content %}
<div class="product-page">
   <!-- Breadcrumbs -->
   <nav class="breadcrumbs">
      <a href="/">Home</a> › <a href="/category">{{ product.tags[0] }}</a> ›
      <span>{{ product.name }}</span>
   </nav>

   <!-- Main grid: image left, info right -->
   <div class="product-main-grid">
      <!-- Left: Image -->
      <div class="product-detail-image">
         <img src="{{ product.image }}" alt="{{ product.name }}" />
      </div>

      <!-- Right: Info -->
      <div class="product-detail-info">
         <!-- Name -->
         <h1 class="product-name">{{ product.name }}</h1>

         <!-- Ratings & stock -->
         <div class="ratings-stock">
            <div class="product-rating">
               {% for i in range(1, 6) %}
                  {% if i <= product.rating %}
                     <i class="fas fa-star filled"></i>
                  {% else %}
                     <i class="fas fa-star empty"></i>
                  {% endif %}
               {% endfor %}
               <span class="reviews">({{ product.reviews }})</span>
            </div>
         </div>

         <!-- Price + sold -->
         <div class="price-sold">
            <span class="discount-price">${{ product.discount_price }}</span>
            <span class="original-price">${{ product.original_price }}</span>
            <span class="sold">{{ product.sold.last30 }}+ sold</span>
            <span class="stock">In stock</span>
         </div>

         <!-- Description -->
         <div class="description">
            <p>{{ product.description }}</p>
         </div>

         <hr />

         <!-- Variants -->
         <div class="variants">
            <div class="colors">
               <span>Colors:</span>
               <div class="color-options">
                  <div class="color-circle blue"></div>
                  <div class="color-circle grey"></div>
                  <div class="color-circle black"></div>
               </div>
            </div>
         </div>

         <!-- Quantity & buttons -->
         <div class="purchase-box">
            <form action="{{ url_for('update_cart', product_id=product.id) }}" method="POST" id="quantity-form">
               <div class="quantity">
                  <button type="button" class="qty-btn left"><i class="fas fa-minus"></i></button>
                  <input
                     name="quantity"
                     id="quantity-input"
                     type="number"
                     value="1"
                     min="1"
                     class="qty-input" />
                  <button type="button" class="qty-btn right"><i class="fas fa-plus"></i></button>
               </div>
            </form>

            <button class="buy-btn">
               <a href="{{ url_for('add', product_id=product.id) }}">Buy Now</a>
            </button>
            <button class="wishlist-btn"><i class="far fa-heart"></i></button>
         </div>

         <!-- Delivery / return info -->
         <div class="service-boxes">
            <div class="service-item">
               <i class="fas fa-truck"></i>
               <div class="service-item-group">
                  <div class="title">Free Delivery</div>
                  <div class="subtitle">Enter your postal code for options</div>
               </div>
            </div>
            <div class="service-item">
               <i class="fas fa-undo"></i>
               <div class="service-item-group">
                  <div class="title">30 Days Returns</div>
                  <div class="subtitle">Free returns within 30 days</div>
               </div>
            </div>
         </div>
      </div>
   </div>

   <!-- Related items -->
   <section class="related-products">
      <h2>Related Items</h2>
      <div class="related-grid">
         {% if related_products %}
            {% for related in related_products %}
               <div class="product-card">
                  <a href="{{ url_for('product_detail', product_id=related.id) }}">
                     <div class="product-image-wrapper">
                        <img src="{{ related.image }}" alt="{{ related.name }}" />
                        <span class="discount-badge">
                           -{{ ((1 - (related.discount_price / related.original_price)) * 100) | round(0) }}%
                        </span>
                     </div>
                  </a>

                  <div class="product-info">
                     <a href="{{ url_for('product_detail', product_id=related.id) }}">
                        <h3 class="product-name">{{ related.name }}</h3>
                     </a>

                     <div class="product-meta">
                        <span class="tag">{{ related.tags.0 }}</span>
                        <span class="price">
                           <span class="discount-price">${{ related.discount_price }}</span>
                           <span class="original-price">${{ related.original_price }}</span>
                        </span>
                        <button class="cart-btn">
                           <a href="{{ url_for('add', product_id=related.id) }}">
                              <i class="fas fa-cart-plus"></i>
                           </a>
                        </button>
                     </div>

                     <div class="product-rating">
                        ⭐ {{ related.rating }} ({{ related.reviews }} reviews)
                     </div>
                  </div>
               </div>
            {% endfor %}
         {% else %}
            <p>No related items found.</p>
         {% endif %}
      </div>
   </section>

   <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
</div>
{% endblock %}
